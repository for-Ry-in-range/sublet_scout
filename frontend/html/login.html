<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login / Sign Up</title>
  <style>
    body { font-family: system-ui, -apple-system, Arial, sans-serif; margin: 24px; }
    .wrap { display: flex; gap: 24px; flex-wrap: wrap; }
    form { border: 1px solid #ddd; border-radius: 8px; padding: 16px; min-width: 320px; flex: 1; }
    label { display:block; margin-top: 10px; font-weight: 600; }
    input { width: 100%; padding: 8px; margin-top: 6px; box-sizing: border-box; }
    button { margin-top: 14px; padding: 10px 14px; cursor: pointer; }
    .err { color: #b00020; margin-top: 8px; min-height: 1em; }
    .ok { color: #064; margin-top: 8px; min-height: 1em; }
  </style>
</head>
<body>
  <h2>.edu-only Login / Sign Up</h2>
  <div class="wrap">
    <form id="signup" action="/signup" method="POST" novalidate>
      <h3>Sign Up</h3>
      <label>Email (.edu)<input type="email" name="email" required></label>
      <label>First Name<input type="text" name="first_name"></label>
      <label>Last Name<input type="text" name="last_name"></label>
      <label>Password (min 8)<input type="password" name="password" minlength="8" required></label>
      <button type="submit">Create Account</button>
      <div class="ok" id="su-ok"></div>
      <div class="err" id="su-err"></div>
    </form>

    <form id="login" action="/login" method="POST" novalidate>
      <h3>Login</h3>
      <label>Email (.edu)<input type="email" name="email" required></label>
      <label>Password<input type="password" name="password" required></label>
      <button type="submit">Login</button>
      <div class="err" id="li-err"></div>
    </form>
  </div>

  <script>
    function isEdu(e){return typeof e==='string' && e.toLowerCase().trim().endsWith('.edu');}
    async function handle(e, path){
      e.preventDefault();
      const form=e.target, data=new FormData(form);
      const email=(data.get('email')||'').toString();
      const pass=(data.get('password')||'').toString();
      const ok=document.getElementById('su-ok');
      const err=document.getElementById(path==='/signup'?'su-err':'li-err');
      if(ok) ok.textContent=''; err.textContent='';
      if(!isEdu(email)){err.textContent='Email must end with .edu.'; return;}
      if(path==='/signup' && pass.length<8){err.textContent='Password must be at least 8 characters.'; return;}
      const res=await fetch(path,{method:'POST', body:data, credentials:'same-origin'});
      let t=await res.text(); let j={};
      try{j=JSON.parse(t);}catch{j={detail:t};}
      if(res.ok){
        if(path==='/login'){ window.location.href='/profile'; }
        else { ok.textContent=j.message||'Account created. Log in now.'; form.reset(); }
      }else{
        err.textContent=j.detail||j.message||'Error';
      }
    }
    document.getElementById('signup').addEventListener('submit', e=>handle(e,'/signup'));
    document.getElementById('login').addEventListener('submit', e=>handle(e,'/login'));
  </script>
</body>
</html>
