{% extends "base.html" %}

{% block title %}Sublet Scout - Search Page{% endblock %}

{% block content %}
    <header>
        <h1>Sublet Scout</h1>
        <p>Find Available Subleases in NYC</p>
    </header>

    <div class="layout">

        <div class="content">
            <section class="search-bar">
                <form action="{{ url_for('show_search') }}" method="get" style="display:flex;gap:.5rem;align-items:center;">
                    <input type="text" name="q" placeholder="Search by neighborhood, address, or school..." />
                    {% if user_id %}
                        <input type="hidden" name="user_id" value="{{ user_id }}">
                    {% endif %}
                    <button type="submit">Search</button>
                </form>
            </section>

            <section class="results">
                {% for r in results %}
                <div class="card">
                    <h3>{{ r.title }}</h3>
                    <p>${{ r.cost_per_month }} / month</p>
                    {% if r.available_start_date or r.available_end_date %}
                        <p>Available: {{ r.available_start_date or "N/A" }} - {{ r.available_end_date or "N/A" }}</p>
                    {% endif %}
                    <p><a href="{{ url_for('render_individual_apt') }}{% if user_id %}?user_id={{ user_id }}{% endif %}">View listing</a></p>
                </div>
                {% else %}
                <div class="card">
                    <p>No results found.</p>
                </div>
                {% endfor %}
            </section>

            <section>
                <div id="map" style="height:360px;width:100%;"></div>
            </section>
        </div>

    </div>

    <!-- Google Maps -->
    <script>
        function initMap() {
            var nyc = { lat: 40.7128, lng: -74.0060 };
            var map = new google.maps.Map(document.getElementById('map'), {
                zoom: 12,
                center: nyc
            });
            new google.maps.Marker({position: nyc, map: map});
        }
    </script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key={{ map_key }}&callback=initMap">
    </script>
{% endblock %}